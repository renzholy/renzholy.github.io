<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="shortcut icon" type="image/png" href="https://github.com/renzholy.png?size=128"/><title>WASM è¾“å…¥ä¸è¾“å‡º</title><meta name="author" content="renzholy"/><meta name="date" content="2022-06-26"/><meta name="application-name" content="WASM è¾“å…¥ä¸è¾“å‡º"/><meta name="description" content="## WASM ç®€ä»‹

WASMï¼ˆWebAssemblyï¼‰æ˜¯ä¸€ç§ç”¨äºå †æ ˆå¼è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒæ˜¯æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼æ ‡å‡†ï¼Œä¸æ˜¯ç‰¹å®šçš„è™šæ‹Ÿæœºå®ç°ï¼Œå› æ­¤æœ‰å„ç§ compilerã€interpreter ä»¥åŠ runtimeï¼Œå¦‚[wastime](https://github.com/bytecodealliance/wasmtime)ã€[Wasmer](https://wasmer.io/)ã€[V8](https://v8.dev/docs/wasm-compilation-pipeline)ã€ [Luc..."/><meta name="theme-color" content="#24292e"/><meta property="og:url" content="https://fpt.ink/wasm/è¾“å…¥ä¸è¾“å‡º"/><meta property="og:type" content="blog"/><meta property="og:title" content="WASM è¾“å…¥ä¸è¾“å‡º"/><meta property="og:site_name" content="Found Pan Tiger"/><meta property="og:description" content="## WASM ç®€ä»‹

WASMï¼ˆWebAssemblyï¼‰æ˜¯ä¸€ç§ç”¨äºå †æ ˆå¼è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒæ˜¯æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼æ ‡å‡†ï¼Œä¸æ˜¯ç‰¹å®šçš„è™šæ‹Ÿæœºå®ç°ï¼Œå› æ­¤æœ‰å„ç§ compilerã€interpreter ä»¥åŠ runtimeï¼Œå¦‚[wastime](https://github.com/bytecodealliance/wasmtime)ã€[Wasmer](https://wasmer.io/)ã€[V8](https://v8.dev/docs/wasm-compilation-pipeline)ã€ [Luc..."/><meta name="twitter:card" content="summary"/><meta name="twitter:domain" content="fpt.ink"/><meta name="twitter:url" content="https://fpt.ink/wasm/è¾“å…¥ä¸è¾“å‡º"/><meta name="twitter:title" content="WASM è¾“å…¥ä¸è¾“å‡º"/><meta name="twitter:description" content="## WASM ç®€ä»‹

WASMï¼ˆWebAssemblyï¼‰æ˜¯ä¸€ç§ç”¨äºå †æ ˆå¼è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒæ˜¯æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼æ ‡å‡†ï¼Œä¸æ˜¯ç‰¹å®šçš„è™šæ‹Ÿæœºå®ç°ï¼Œå› æ­¤æœ‰å„ç§ compilerã€interpreter ä»¥åŠ runtimeï¼Œå¦‚[wastime](https://github.com/bytecodealliance/wasmtime)ã€[Wasmer](https://wasmer.io/)ã€[V8](https://v8.dev/docs/wasm-compilation-pipeline)ã€ [Luc..."/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/52f378189a8709f9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52f378189a8709f9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-962449b389de7a23.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-619fc981483afe9e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ce056a74a3cd3589.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/827-c7415ccd8033e3a7.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-7f16f7784066193c.js" defer=""></script><script src="/_next/static/XvQqgVKXZyTL6GdtsbpHY/_buildManifest.js" defer=""></script><script src="/_next/static/XvQqgVKXZyTL6GdtsbpHY/_ssgManifest.js" defer=""></script><script src="/_next/static/XvQqgVKXZyTL6GdtsbpHY/_middlewareManifest.js" defer=""></script><style data-emotion="css 1uruf9f 35tm3r 82a6rk atf797 15sbtt4 hv4a7g 11sb6mr">::-webkit-scrollbar{display:none;}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;}:root{--max-width:900px;}.css-35tm3r{position:fixed;top:0;left:0;right:0;height:64px;background-color:#24292e;padding:0 20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-35tm3r a{color:#ffffff;font-size:14px;font-weight:600;-webkit-text-decoration:none;text-decoration:none;}.css-35tm3r a+a{margin-left:16px;}.css-35tm3r a:hover,.css-35tm3r a:focus{color:hsla(0, 0%, 100%, 0.7);}.css-82a6rk{-webkit-flex:1;-ms-flex:1;flex:1;}.css-atf797{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:64px;padding:0 20px;border-top:1px solid #e1e4e8;}.css-atf797 span{color:#586069;font-size:12px;}.css-atf797 a{color:#0366d6;-webkit-text-decoration:none;text-decoration:none;font-size:12px;}.css-atf797 a+a{margin-left:16px;}.css-atf797 a:hover,.css-atf797 a:focus{-webkit-text-decoration:underline;text-decoration:underline;}.css-15sbtt4{margin:16px auto;padding:0 20px;max-width:var(--max-width);font-size:14px;color:#6a737d;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}.css-hv4a7g{margin:96px auto 32px;max-width:var(--max-width);min-height:calc(
            100vh - 96px - 2 * 64px - 2px - 302px
          );}.css-hv4a7g h1>a:nth-child(1),.css-hv4a7g h2>a:nth-child(1),.css-hv4a7g h3>a:nth-child(1),.css-hv4a7g h4>a:nth-child(1),.css-hv4a7g h5>a:nth-child(1),.css-hv4a7g h6>a:nth-child(1){float:left;line-height:1;margin-left:-20px;padding-right:4px;}.css-hv4a7g h1>a:nth-child(1):focus,.css-hv4a7g h2>a:nth-child(1):focus,.css-hv4a7g h3>a:nth-child(1):focus,.css-hv4a7g h4>a:nth-child(1):focus,.css-hv4a7g h5>a:nth-child(1):focus,.css-hv4a7g h6>a:nth-child(1):focus{outline:none;}.css-hv4a7g h1>a:nth-child(1)>span,.css-hv4a7g h2>a:nth-child(1)>span,.css-hv4a7g h3>a:nth-child(1)>span,.css-hv4a7g h4>a:nth-child(1)>span,.css-hv4a7g h5>a:nth-child(1)>span,.css-hv4a7g h6>a:nth-child(1)>span{color:#1b1f23;vertical-align:middle;visibility:hidden;display:inline-block;fill:currentColor;vertical-align:text-bottom;}.css-hv4a7g h1:hover>a:nth-child(1),.css-hv4a7g h2:hover>a:nth-child(1),.css-hv4a7g h3:hover>a:nth-child(1),.css-hv4a7g h4:hover>a:nth-child(1),.css-hv4a7g h5:hover>a:nth-child(1),.css-hv4a7g h6:hover>a:nth-child(1){-webkit-text-decoration:none;text-decoration:none;}.css-hv4a7g h1:hover>a:nth-child(1)>span,.css-hv4a7g h2:hover>a:nth-child(1)>span,.css-hv4a7g h3:hover>a:nth-child(1)>span,.css-hv4a7g h4:hover>a:nth-child(1)>span,.css-hv4a7g h5:hover>a:nth-child(1)>span,.css-hv4a7g h6:hover>a:nth-child(1)>span{visibility:visible;}.css-hv4a7g h1:hover>a:nth-child(1)>span:before,.css-hv4a7g h2:hover>a:nth-child(1)>span:before,.css-hv4a7g h3:hover>a:nth-child(1)>span:before,.css-hv4a7g h4:hover>a:nth-child(1)>span:before,.css-hv4a7g h5:hover>a:nth-child(1)>span:before,.css-hv4a7g h6:hover>a:nth-child(1)>span:before{width:16px;height:16px;content:' ';display:inline-block;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'%3E%3C/path%3E%3C/svg%3E");}.css-hv4a7g{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.5;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word;padding:0 20px;}.css-hv4a7g details{display:block;}.css-hv4a7g summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}.css-hv4a7g a{background-color:initial;}.css-hv4a7g a:active,.css-hv4a7g a:hover{outline-width:0;}.css-hv4a7g strong{font-weight:inherit;font-weight:bolder;}.css-hv4a7g h1{font-size:2em;margin:0.67em 0;}.css-hv4a7g img{border-style:none;}.css-hv4a7g code,.css-hv4a7g kbd,.css-hv4a7g pre{font-family:monospace,monospace;font-size:1em;}.css-hv4a7g hr{box-sizing:initial;height:0;overflow:visible;}.css-hv4a7g input{font:inherit;margin:0;}.css-hv4a7g input{overflow:visible;}.css-hv4a7g [type='checkbox']{box-sizing:border-box;padding:0;}.css-hv4a7g *{box-sizing:border-box;}.css-hv4a7g input{font-family:inherit;font-size:inherit;line-height:inherit;}.css-hv4a7g a{color:#0366d6;-webkit-text-decoration:none;text-decoration:none;}.css-hv4a7g a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-hv4a7g strong{font-weight:600;}.css-hv4a7g hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border:0;border-bottom:1px solid #dfe2e5;}.css-hv4a7g hr:after,.css-hv4a7g hr:before{display:table;content:'';}.css-hv4a7g hr:after{clear:both;}.css-hv4a7g table{border-spacing:0;border-collapse:collapse;}.css-hv4a7g td,.css-hv4a7g th{padding:0;}.css-hv4a7g details summary{cursor:pointer;}.css-hv4a7g kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da;}.css-hv4a7g h1,.css-hv4a7g h2,.css-hv4a7g h3,.css-hv4a7g h4,.css-hv4a7g h5,.css-hv4a7g h6{margin-top:0;margin-bottom:0;}.css-hv4a7g h1{font-size:32px;}.css-hv4a7g h1,.css-hv4a7g h2{font-weight:600;}.css-hv4a7g h2{font-size:24px;}.css-hv4a7g h3{font-size:20px;}.css-hv4a7g h3,.css-hv4a7g h4{font-weight:600;}.css-hv4a7g h4{font-size:16px;}.css-hv4a7g h5{font-size:14px;}.css-hv4a7g h5,.css-hv4a7g h6{font-weight:600;}.css-hv4a7g h6{font-size:12px;}.css-hv4a7g p{margin-top:0;margin-bottom:10px;}.css-hv4a7g blockquote{margin:0;}.css-hv4a7g ol,.css-hv4a7g ul{padding-left:0;margin-top:0;margin-bottom:0;}.css-hv4a7g ol ol,.css-hv4a7g ul ol{list-style-type:lower-roman;}.css-hv4a7g ol ol ol,.css-hv4a7g ol ul ol,.css-hv4a7g ul ol ol,.css-hv4a7g ul ul ol{list-style-type:lower-alpha;}.css-hv4a7g dd{margin-left:0;}.css-hv4a7g code,.css-hv4a7g pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;}.css-hv4a7g pre{margin-top:0;margin-bottom:0;}.css-hv4a7g input::-webkit-inner-spin-button,.css-hv4a7g input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;}.css-hv4a7g hr{border-bottom-color:#eee;}.css-hv4a7g kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da;}.css-hv4a7g a:not([href]){color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-hv4a7g blockquote,.css-hv4a7g details,.css-hv4a7g dl,.css-hv4a7g ol,.css-hv4a7g p,.css-hv4a7g pre,.css-hv4a7g table,.css-hv4a7g ul{margin-top:0;margin-bottom:16px;}.css-hv4a7g hr{height:0.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0;}.css-hv4a7g blockquote{padding:0 1em;color:#6a737d;border-left:0.25em solid #dfe2e5;}.css-hv4a7g blockquote>:first-child{margin-top:0;}.css-hv4a7g blockquote>:last-child{margin-bottom:0;}.css-hv4a7g h1,.css-hv4a7g h2,.css-hv4a7g h3,.css-hv4a7g h4,.css-hv4a7g h5,.css-hv4a7g h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25;}.css-hv4a7g h1{font-size:2em;}.css-hv4a7g h1,.css-hv4a7g h2{padding-bottom:0.3em;border-bottom:1px solid #eaecef;}.css-hv4a7g h2{font-size:1.5em;}.css-hv4a7g h3{font-size:1.25em;}.css-hv4a7g h4{font-size:1em;}.css-hv4a7g h5{font-size:0.875em;}.css-hv4a7g h6{font-size:0.85em;color:#6a737d;}.css-hv4a7g ol,.css-hv4a7g ul{padding-left:2em;}.css-hv4a7g ol ol,.css-hv4a7g ol ul,.css-hv4a7g ul ol,.css-hv4a7g ul ul{margin-top:0;margin-bottom:0;}.css-hv4a7g li{word-wrap:break-all;}.css-hv4a7g li>p{margin-top:16px;}.css-hv4a7g li+li{margin-top:0.25em;}.css-hv4a7g dl{padding:0;}.css-hv4a7g dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600;}.css-hv4a7g dl dd{padding:0 16px;margin-bottom:16px;}.css-hv4a7g table{display:block;width:100%;overflow:auto;}.css-hv4a7g table th{font-weight:600;}.css-hv4a7g table td,.css-hv4a7g table th{padding:6px 13px;border:1px solid #dfe2e5;}.css-hv4a7g table tr{background-color:#fff;border-top:1px solid #c6cbd1;}.css-hv4a7g table tr:nth-child(2n){background-color:#f6f8fa;}.css-hv4a7g img{max-width:100%;box-sizing:initial;}.css-hv4a7g img[align='right']{padding-left:20px;}.css-hv4a7g img[align='left']{padding-right:20px;}.css-hv4a7g code{padding:0.2em 0.4em;margin:0;font-size:85%;background-color:rgba(27, 31, 35, 0.05);border-radius:3px;}.css-hv4a7g pre{word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px;}.css-hv4a7g pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;border:0;display:inline;max-width:auto;overflow:visible;line-height:inherit;background-color:initial;}.css-hv4a7g .task-list-item{list-style-type:none;}.css-hv4a7g .task-list-item+.task-list-item{margin-top:3px;}.css-hv4a7g .task-list-item input{margin:0 0.2em 0.25em -1.6em;vertical-align:middle;}.css-11sb6mr{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-top:1px solid #e1e4e8;padding:16px;min-height:270px;}.css-11sb6mr .utterances{max-width:var(--max-width);}</style></head><body><div id="__next" data-reactroot=""><nav class="css-35tm3r"><a href="/">Found Pan Tiger</a><div class="css-82a6rk"></div><a href="/about">About</a></nav><article class="css-hv4a7g"><h1 id="wasm-è¾“å…¥ä¸è¾“å‡º"><a href="/wasm/%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA#wasm-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA" aria-hidden="true" tabindex="-1"><span></span></a>WASM è¾“å…¥ä¸è¾“å‡º</h1>
<h2 id="wasm-ç®€ä»‹"><a href="/wasm/%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA#wasm-%E7%AE%80%E4%BB%8B" aria-hidden="true" tabindex="-1"><span></span></a>WASM ç®€ä»‹</h2>
<p>WASMï¼ˆWebAssemblyï¼‰æ˜¯ä¸€ç§ç”¨äºå †æ ˆå¼è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒæ˜¯æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼æ ‡å‡†ï¼Œä¸æ˜¯ç‰¹å®šçš„è™šæ‹Ÿæœºå®ç°ï¼Œå› æ­¤æœ‰å„ç§ compilerã€interpreter ä»¥åŠ runtimeï¼Œå¦‚<a href="https://github.com/bytecodealliance/wasmtime" target="_blank" rel="noreferrer">wastime</a>ã€<a href="https://wasmer.io/" target="_blank" rel="noreferrer">Wasmer</a>ã€<a href="https://v8.dev/docs/wasm-compilation-pipeline" target="_blank" rel="noreferrer">V8</a>ã€ <a href="https://github.com/bytecodealliance/lucet/" target="_blank" rel="noreferrer">Lucet</a>ã€<a href="https://github.com/bytecodealliance/wasm-micro-runtime" target="_blank" rel="noreferrer">WAMR</a>ã€<a href="https://github.com/wasm3/wasm3/" target="_blank" rel="noreferrer">wasm3</a>ã€‚</p>
<p>WASM åœ¨è®¾è®¡ä¹‹åˆï¼Œè€ƒè™‘äº†ä»¥ä¸‹å‡ ç‚¹ï¼š<a href="https://webassembly.org/" target="_blank" rel="noreferrer">ğŸ”—</a></p>
<ul>
<li><strong>é«˜æ•ˆå’Œå¿«é€Ÿ</strong>ï¼šä½“ç§¯å°ï¼ŒåŠ è½½é€Ÿåº¦å¿«ã€‚å¯ä»¥æµå¼åŠ è½½ï¼Œè¾¹ä¸‹è½½è¾¹åˆå§‹åŒ–ï¼Œå‡å°‘æ—¶é—´å’Œå†…å­˜å ç”¨ã€‚ç†è®ºä¸Šå¯ä»¥è¾¾åˆ°åŸç”Ÿçš„è¿è¡Œé€Ÿåº¦ã€‚</li>
<li><strong>å®‰å…¨</strong>ï¼šWASM æè¿°äº†ä¸€ä¸ªå†…å­˜å®‰å…¨çš„æ²™ç®±æ‰§è¡Œç¯å¢ƒï¼Œç”šè‡³å¯ä»¥åœ¨ç°æœ‰çš„ JavaScript è™šæ‹Ÿæœºä¸­å®ç°ã€‚</li>
<li><strong>å¼€æ”¾å¯è°ƒè¯•</strong>ï¼šå¯ä»¥ç¿»è¯‘ä¸ºå¯è¯»çš„æ–‡æœ¬æ ¼å¼<code>.wat</code>ï¼ˆå¯ä»¥ç†è§£ä¸º WASM å¹³å°çš„æ±‡ç¼–è¯­è¨€ï¼‰ï¼Œé…åˆ source map æ–¹ä¾¿è°ƒè¯•ã€‚</li>
<li><strong>Web æ ‡å‡†</strong>ï¼šæ¨¡å—èƒ½å¤Ÿä¼ å…¥å’Œä¼ å‡º JavaScript ä¸Šä¸‹æ–‡ï¼Œå¹¶é€šè¿‡ JavaScript è®¿é—® Web API æ¥è®¿é—®æµè§ˆå™¨åŠŸèƒ½ã€‚åŒæ—¶ä¹Ÿ<strong>æ”¯æŒéæµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œ</strong>ã€‚</li>
</ul>
<p>ä½†ä¹Ÿæœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p>
<ul>
<li>åŸºç¡€æ•°æ®ç±»å‹åªæœ‰ i32ã€i64ã€f32ã€f64ã€‚é«˜çº§æ•°æ®ç»“æ„ï¼ˆå¦‚ï¼šå­—ç¬¦ä¸²ï¼‰æ¯ç§è¯­è¨€éœ€è¦è‡ªå·±å®ç°ã€‚<a href="https://www.assemblyscript.org/memory.html#internals" target="_blank" rel="noreferrer">ğŸ”—</a></li>
<li>åªèƒ½è¿›è¡ŒåŒæ­¥è®¡ç®—ï¼Œä¸æ”¯æŒå¼‚æ­¥å‡½æ•°ã€‚</li>
<li>å¯¹äº Goã€Python è¿™ç§å¸¦è¿è¡Œæ—¶çš„è¯­è¨€ç¼–è¯‘åˆ° WASMï¼Œéœ€è¦å°†è¿è¡Œæ—¶ä¸€èµ·æ‰“åŒ…ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä½“ç§¯è¾ƒå¤§ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨ Node.jsï¼ˆV8ï¼‰ä½œä¸º runtime è¯­è¨€ï¼ŒAssemblyScript ä½œä¸ºç¼–è¯‘åˆ° WASM çš„è¯­è¨€ï¼Œæ¥åšç‚¹å®éªŒã€‚</p>
<h2 id="assemblyscript"><a href="/wasm/%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA#assemblyscript" aria-hidden="true" tabindex="-1"><span></span></a>AssemblyScript</h2>
<blockquote>
<p>A language made for WebAssembly.</p>
</blockquote>
<p>å¯¹äºå¾ˆå¤šåœ¨ WASM è¯ç”Ÿå‰å°±å·²ç»å­˜åœ¨çš„è¯­è¨€ï¼ŒWASM å°±åƒ x86ã€ARM64 ä¸€æ ·ï¼Œåªæ˜¯ä¸€ç§æ–°çš„ platform targetã€‚</p>
<p>è€Œ AssemblyScript æ˜¯ä¸€ä¸ªä¸º WASM è€Œç”Ÿçš„è¯­è¨€ï¼Œç›®å‰åªèƒ½ç¼–è¯‘åˆ° WASMã€‚å®ƒçš„è¯­æ³•æ˜¯ä¸€ç§ TypeScript çš„å˜ä½“ï¼Œä½†å®é™…å†™èµ·æ¥æ—¶ï¼Œæœ‰æ—¶å´è¦åƒå†™ C è¯­è¨€é‚£æ ·æ€è€ƒã€‚</p>
<p>AssemblyScript é¡¹ç›®æ­å»ºè¯·å‚è€ƒ<a href="https://www.assemblyscript.org/quick-start.html" target="_blank" rel="noreferrer">Quick Start</a>ã€‚</p>
<h2 id="ab"><a href="/wasm/%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA#ab" aria-hidden="true" tabindex="-1"><span></span></a>a+b</h2>
<p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç®€å•çš„ a+bï¼Œä¸ºä»€ä¹ˆä¸æ˜¯ hello worldï¼Ÿå› ä¸ºå­—ç¬¦ä¸²åœ¨ WASM é‡Œæ˜¯é«˜çº§æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„ i32 å¼€å§‹ï¼š</p>
<pre><code>// sum.ts
export function sum(a: i32, b: i32): i32 {
  return a + b;
}</code></pre>
<p>ç¼–è¯‘åå¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶<code>sum.wasm</code>ï¼Œå’Œä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶<code>sum.wat</code>ã€‚ä¸¤è€…å¯ä»¥ä½¿ç”¨<a href="https://github.com/WebAssembly/wabt" target="_blank" rel="noreferrer">wabt</a>äº’ç›¸è½¬æ¢ã€‚æˆ‘ä»¬ä»¥æ–‡æœ¬æ ¼å¼ä¸ºä¾‹ï¼š</p>
<pre><code>; sum.wat
(module
  (type $t0 (func (param i32 i32) (result i32)))
  (func $sum (type $t0) (param $p0 i32) (param $p1 i32) (result i32)
    local.get $p0
    local.get $p1
    i32.add)
  (memory $memory 0)
  (export &quot;sum&quot; (func $sum))
  (export &quot;memory&quot; (memory 0)))</code></pre>
<p>å¦‚æœå­¦è¿‡æ±‡ç¼–ï¼Œä¸äº†è§£ WAT è¯­æ³•ä¹Ÿå¯ä»¥çœ‹æ‡‚ä¸ªå¤§æ¦‚ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯<code>export &quot;memory&quot;</code>ï¼Œè¿™æ˜¯ WSAM æŠŠå†…å­˜æš´éœ²ç»™ runtimeï¼Œåé¢çš„ä¾‹å­ä¼šç”¨åˆ°ã€‚</p>
<p>æ¥ä¸‹æ¥åœ¨ Node.js ä¸­è°ƒç”¨ï¼š</p>
<pre><code>import fs from &quot;fs&quot;;

const file = await fs.promises.readFile(&quot;./sum.wasm&quot;);
const module = new WebAssembly.Module(file);
const instance = new WebAssembly.Instance(module);

console.log((instance.exports.sum as Function)(1, 2));
// stdout: 3</code></pre>
<p>åªéœ€å‡ è¡Œä»£ç å°±å®Œæˆäº†è°ƒç”¨ï¼Œå¹¶è¾“å‡ºäº†é¢„æœŸçš„ç»“æœã€‚</p>
<h2 id="hello-world"><a href="/wasm/%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA#hello-world" aria-hidden="true" tabindex="-1"><span></span></a>&#x27;hello, world!&#x27;</h2>
<p>æ¥çœ‹çœ‹å­—ç¬¦ä¸²æ˜¯å¦‚ä½•åœ¨ WASM ä¸ runtime ä¹‹é—´ä¼ é€’çš„ã€‚</p>
<pre><code>// hello-world.ts
export function hello_world(): string {
  return `hello, world!`;
}</code></pre>
<p>ç¼–è¯‘åå¾—åˆ°ï¼š</p>
<pre><code>; hello-world.wat
(module
  (type $t0 (func (result i32)))
  (func $hello_world (type $t0) (result i32)
    i32.const 1056)
  (memory $memory 1)
  (export &quot;hello_world&quot; (func $hello_world))
  (export &quot;memory&quot; (memory 0))
  (data $d0 (i32.const 1036) &quot;,&quot;)
  (data $d1 (i32.const 1048) &quot;\01\00\00\00\1a\00\00\00h\00e\00l\00l\00o\00,\00 \00w\00o\00r\00l\00d\00!&quot;))</code></pre>
<p>åœ¨ Node.js ä¸­è°ƒç”¨ï¼š</p>
<pre><code>import fs from &quot;fs&quot;;

const file = await fs.promises.readFile(&quot;./hello-world.wasm&quot;);
const module = new WebAssembly.Module(file);
const instance = new WebAssembly.Instance(module);

console.log((instance.exports.hello_world as Function)());
// stdout: 1056</code></pre>
<p>ç»“æœä¸æ˜¯&quot;hello, world!&quot;ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå‘ç”Ÿä»€ä¹ˆäº‹äº†ï¼Ÿ</p>
<p>è¿™ä¸ªæ•°å­—å…¶å®æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„åœ°å€ï¼Œå®ƒæŒ‡å‘äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é€šè¿‡<a href="https://www.assemblyscript.org/memory.html#string-layout" target="_blank" rel="noreferrer">string-layout</a>è¿™ç¯‡æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ AssemblyScript çš„å­—ç¬¦ä¸²æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­æ’å¸ƒçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»£ç æŠŠå­—ç¬¦ä¸²å–å‡ºæ¥ã€‚</p>
<pre><code>// ...
const offset = (instance.exports.hello_world as Function)();
const memory = instance.exports.memory as WebAssembly.Memory;
const buffer = Buffer.from(memory.buffer);
const len = buffer.readUInt32LE(offset - 4);

console.log(buffer.slice(offset, offset + len).toString());
// stdout: hello, world!</code></pre>
<p>WASM ä½¿ç”¨çš„æ˜¯<a href="https://webassembly.github.io/spec/core/syntax/instructions.html#memory-instructions" target="_blank" rel="noreferrer">little endian byte order</a>ï¼Œå› æ­¤æˆ‘ä»¬ç”¨<code>readUInt32LE</code>è€Œä¸æ˜¯<code>readUInt32BE</code>ã€‚</p>
<h2 id="hello-str"><a href="/wasm/%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA#hello-str" aria-hidden="true" tabindex="-1"><span></span></a>`hello, ${str}!`</h2>
<p>æˆ‘ä»¬å·²ç»å­¦ä¼šæŠŠå­—ç¬¦ä¸²ä» WASM ä¼ åˆ° runtime ä¸­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ åå‘æ“ä½œã€‚</p>
<pre><code>// hello.ts
export function hello(str: string): string {
  return `hello, ${str}!`;
}</code></pre>
<p>ä½¿ç”¨ç¼–è¯‘å‚æ•°ï¼š</p>
<pre><code>asc hello.ts --use abort= --target release</code></pre>
<p>æˆ‘ä»¬åªæ”¹äº†å‡ ä¸ªå­—ç¬¦ï¼Œä½†è¿™æ¬¡ç¼–è¯‘å‡ºçš„ hello.wat å·²ç»æœ‰ 400+è¡Œã€‚</p>
<p>åœ¨å‰ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œå†…å­˜æ˜¯é™æ€çš„ï¼Œè€Œåœ¨è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬è¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°±æ¶‰åŠåˆ°äº†å†…å­˜çš„åŠ¨æ€ç®¡ç†ã€‚å› æ­¤ AssemblyScript éœ€è¦æŠŠå†…å­˜å›æ”¶è¿è¡Œæ—¶æ‰“åŒ…è¿› WASMï¼Œå°±å¢åŠ äº†æ–‡ä»¶ä½“ç§¯ã€‚</p>
<pre><code>// ...
const memory = instance.exports.memory as WebAssembly.Memory;
const buffer = Buffer.from(memory.buffer);
const str = &quot;wasm&quot;;
const ptr = 1024;
buffer.writeUInt32LE(str.length, ptr - 4);
Buffer.from(str).copy(buffer, ptr);
const offset = (instance.exports.hello as Function)(ptr);
const len = buffer.readUInt32LE(offset - 4);

console.log(buffer.slice(offset, offset + len).toString());
// stdout: hello, wasm!</code></pre>
<p>è¿™é‡Œçš„<code>ptr = 1024</code>æ˜¯ä¸€ä¸ªå±é™©çš„åšæ³•ï¼Œè¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬å‡å®š WASM ä¸ä¼šä½¿ç”¨ç¬¬ 1024 ä¸ªå­—èŠ‚é™„è¿‘çš„å†…å­˜ï¼Œå®é™…ä½¿ç”¨ä¸­ä¸èƒ½è¿™ä¹ˆå†™ï¼Œè¿™æ ·å¯èƒ½ä¼šè¦†ç›–æ‰ WASM æ‰€éœ€è¦çš„æ•°æ®ï¼Œä½¿ WASM è¿è¡Œå¼‚å¸¸ã€‚</p>
<p>AssemblyScript æä¾›äº†<a href="https://www.assemblyscript.org/loader.html#loader" target="_blank" rel="noreferrer">Loader</a>ï¼Œå°è£…äº†è¿™ç§é«˜çº§æ•°æ®ç»“æ„ä¼ é€’çš„æ–¹æ³•ï¼›Rust ä¹Ÿæä¾›äº†<a href="https://github.com/rustwasm/wasm-bindgen" target="_blank" rel="noreferrer">wasm-bingen</a>ï¼Œå¯ä»¥ç”Ÿæˆ<code>.js</code>å’Œ<code>.d.ts</code>æ–‡ä»¶ï¼Œåœ¨ js ä»£ç ä¸­ç›´æ¥ import å°±å¯ä»¥è°ƒç”¨ Rust ç¼–å†™çš„ WASM æ¨¡å—ä¸­çš„å‡½æ•°ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹å¦‚ä½•åœ¨ WASM ä¸ runtime ä¹‹é—´ä¼ é€’æ•°æ®å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚</p></article><footer class="css-15sbtt4">Last modified:Â <time title="Sun, 26 Jun 2022 12:13:32 GMT">2022-06-26</time></footer><section class="css-11sb6mr"></section><footer class="css-atf797"><span>Generated by:Â <a href="https://github.com/renzholy/blogit" target="_blank" rel="noreferrer">Blogit</a></span><span class="css-82a6rk"></span><a href="https://github.com/renzholy" target="_blank" rel="noreferrer">GitHub</a><a href="http://twitter.com/aliez_eth" target="_blank" rel="noreferrer">Twitter</a><a href="https://web.okjike.com/u/d25026f2-18ce-48aa-9ea7-c05a25446368" target="_blank" rel="noreferrer">Jike</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"lastModified":"Sun, 26 Jun 2022 12:13:32 GMT","data":"# WASM è¾“å…¥ä¸è¾“å‡º\n\n## WASM ç®€ä»‹\n\nWASMï¼ˆWebAssemblyï¼‰æ˜¯ä¸€ç§ç”¨äºå †æ ˆå¼è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚å®ƒæ˜¯æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼æ ‡å‡†ï¼Œä¸æ˜¯ç‰¹å®šçš„è™šæ‹Ÿæœºå®ç°ï¼Œå› æ­¤æœ‰å„ç§ compilerã€interpreter ä»¥åŠ runtimeï¼Œå¦‚[wastime](https://github.com/bytecodealliance/wasmtime)ã€[Wasmer](https://wasmer.io/)ã€[V8](https://v8.dev/docs/wasm-compilation-pipeline)ã€ [Lucet](https://github.com/bytecodealliance/lucet/)ã€[WAMR](https://github.com/bytecodealliance/wasm-micro-runtime)ã€[wasm3](https://github.com/wasm3/wasm3/)ã€‚\n\nWASM åœ¨è®¾è®¡ä¹‹åˆï¼Œè€ƒè™‘äº†ä»¥ä¸‹å‡ ç‚¹ï¼š[ğŸ”—](https://webassembly.org/)\n\n- **é«˜æ•ˆå’Œå¿«é€Ÿ**ï¼šä½“ç§¯å°ï¼ŒåŠ è½½é€Ÿåº¦å¿«ã€‚å¯ä»¥æµå¼åŠ è½½ï¼Œè¾¹ä¸‹è½½è¾¹åˆå§‹åŒ–ï¼Œå‡å°‘æ—¶é—´å’Œå†…å­˜å ç”¨ã€‚ç†è®ºä¸Šå¯ä»¥è¾¾åˆ°åŸç”Ÿçš„è¿è¡Œé€Ÿåº¦ã€‚\n- **å®‰å…¨**ï¼šWASM æè¿°äº†ä¸€ä¸ªå†…å­˜å®‰å…¨çš„æ²™ç®±æ‰§è¡Œç¯å¢ƒï¼Œç”šè‡³å¯ä»¥åœ¨ç°æœ‰çš„ JavaScript è™šæ‹Ÿæœºä¸­å®ç°ã€‚\n- **å¼€æ”¾å¯è°ƒè¯•**ï¼šå¯ä»¥ç¿»è¯‘ä¸ºå¯è¯»çš„æ–‡æœ¬æ ¼å¼`.wat`ï¼ˆå¯ä»¥ç†è§£ä¸º WASM å¹³å°çš„æ±‡ç¼–è¯­è¨€ï¼‰ï¼Œé…åˆ source map æ–¹ä¾¿è°ƒè¯•ã€‚\n- **Web æ ‡å‡†**ï¼šæ¨¡å—èƒ½å¤Ÿä¼ å…¥å’Œä¼ å‡º JavaScript ä¸Šä¸‹æ–‡ï¼Œå¹¶é€šè¿‡ JavaScript è®¿é—® Web API æ¥è®¿é—®æµè§ˆå™¨åŠŸèƒ½ã€‚åŒæ—¶ä¹Ÿ**æ”¯æŒéæµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œ**ã€‚\n\nä½†ä¹Ÿæœ‰ä»¥ä¸‹é™åˆ¶ï¼š\n\n- åŸºç¡€æ•°æ®ç±»å‹åªæœ‰ i32ã€i64ã€f32ã€f64ã€‚é«˜çº§æ•°æ®ç»“æ„ï¼ˆå¦‚ï¼šå­—ç¬¦ä¸²ï¼‰æ¯ç§è¯­è¨€éœ€è¦è‡ªå·±å®ç°ã€‚[ğŸ”—](https://www.assemblyscript.org/memory.html#internals)\n- åªèƒ½è¿›è¡ŒåŒæ­¥è®¡ç®—ï¼Œä¸æ”¯æŒå¼‚æ­¥å‡½æ•°ã€‚\n- å¯¹äº Goã€Python è¿™ç§å¸¦è¿è¡Œæ—¶çš„è¯­è¨€ç¼–è¯‘åˆ° WASMï¼Œéœ€è¦å°†è¿è¡Œæ—¶ä¸€èµ·æ‰“åŒ…ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä½“ç§¯è¾ƒå¤§ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨ Node.jsï¼ˆV8ï¼‰ä½œä¸º runtime è¯­è¨€ï¼ŒAssemblyScript ä½œä¸ºç¼–è¯‘åˆ° WASM çš„è¯­è¨€ï¼Œæ¥åšç‚¹å®éªŒã€‚\n\n## AssemblyScript\n\n\u003e A language made for WebAssembly.\n\nå¯¹äºå¾ˆå¤šåœ¨ WASM è¯ç”Ÿå‰å°±å·²ç»å­˜åœ¨çš„è¯­è¨€ï¼ŒWASM å°±åƒ x86ã€ARM64 ä¸€æ ·ï¼Œåªæ˜¯ä¸€ç§æ–°çš„ platform targetã€‚\n\nè€Œ AssemblyScript æ˜¯ä¸€ä¸ªä¸º WASM è€Œç”Ÿçš„è¯­è¨€ï¼Œç›®å‰åªèƒ½ç¼–è¯‘åˆ° WASMã€‚å®ƒçš„è¯­æ³•æ˜¯ä¸€ç§ TypeScript çš„å˜ä½“ï¼Œä½†å®é™…å†™èµ·æ¥æ—¶ï¼Œæœ‰æ—¶å´è¦åƒå†™ C è¯­è¨€é‚£æ ·æ€è€ƒã€‚\n\nAssemblyScript é¡¹ç›®æ­å»ºè¯·å‚è€ƒ[Quick Start](https://www.assemblyscript.org/quick-start.html)ã€‚\n\n## a+b\n\næˆ‘ä»¬æ¥å†™ä¸€ä¸ªç®€å•çš„ a+bï¼Œä¸ºä»€ä¹ˆä¸æ˜¯ hello worldï¼Ÿå› ä¸ºå­—ç¬¦ä¸²åœ¨ WASM é‡Œæ˜¯é«˜çº§æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„ i32 å¼€å§‹ï¼š\n\n```typescript\n// sum.ts\nexport function sum(a: i32, b: i32): i32 {\n  return a + b;\n}\n```\n\nç¼–è¯‘åå¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶`sum.wasm`ï¼Œå’Œä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶`sum.wat`ã€‚ä¸¤è€…å¯ä»¥ä½¿ç”¨[wabt](https://github.com/WebAssembly/wabt)äº’ç›¸è½¬æ¢ã€‚æˆ‘ä»¬ä»¥æ–‡æœ¬æ ¼å¼ä¸ºä¾‹ï¼š\n\n```clojure\n; sum.wat\n(module\n  (type $t0 (func (param i32 i32) (result i32)))\n  (func $sum (type $t0) (param $p0 i32) (param $p1 i32) (result i32)\n    local.get $p0\n    local.get $p1\n    i32.add)\n  (memory $memory 0)\n  (export \"sum\" (func $sum))\n  (export \"memory\" (memory 0)))\n```\n\nå¦‚æœå­¦è¿‡æ±‡ç¼–ï¼Œä¸äº†è§£ WAT è¯­æ³•ä¹Ÿå¯ä»¥çœ‹æ‡‚ä¸ªå¤§æ¦‚ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯`export \"memory\"`ï¼Œè¿™æ˜¯ WSAM æŠŠå†…å­˜æš´éœ²ç»™ runtimeï¼Œåé¢çš„ä¾‹å­ä¼šç”¨åˆ°ã€‚\n\næ¥ä¸‹æ¥åœ¨ Node.js ä¸­è°ƒç”¨ï¼š\n\n```typescript\nimport fs from \"fs\";\n\nconst file = await fs.promises.readFile(\"./sum.wasm\");\nconst module = new WebAssembly.Module(file);\nconst instance = new WebAssembly.Instance(module);\n\nconsole.log((instance.exports.sum as Function)(1, 2));\n// stdout: 3\n```\n\nåªéœ€å‡ è¡Œä»£ç å°±å®Œæˆäº†è°ƒç”¨ï¼Œå¹¶è¾“å‡ºäº†é¢„æœŸçš„ç»“æœã€‚\n\n## 'hello, world!'\n\næ¥çœ‹çœ‹å­—ç¬¦ä¸²æ˜¯å¦‚ä½•åœ¨ WASM ä¸ runtime ä¹‹é—´ä¼ é€’çš„ã€‚\n\n```typescript\n// hello-world.ts\nexport function hello_world(): string {\n  return `hello, world!`;\n}\n```\n\nç¼–è¯‘åå¾—åˆ°ï¼š\n\n```clojure\n; hello-world.wat\n(module\n  (type $t0 (func (result i32)))\n  (func $hello_world (type $t0) (result i32)\n    i32.const 1056)\n  (memory $memory 1)\n  (export \"hello_world\" (func $hello_world))\n  (export \"memory\" (memory 0))\n  (data $d0 (i32.const 1036) \",\")\n  (data $d1 (i32.const 1048) \"\\01\\00\\00\\00\\1a\\00\\00\\00h\\00e\\00l\\00l\\00o\\00,\\00 \\00w\\00o\\00r\\00l\\00d\\00!\"))\n```\n\nåœ¨ Node.js ä¸­è°ƒç”¨ï¼š\n\n```typescript\nimport fs from \"fs\";\n\nconst file = await fs.promises.readFile(\"./hello-world.wasm\");\nconst module = new WebAssembly.Module(file);\nconst instance = new WebAssembly.Instance(module);\n\nconsole.log((instance.exports.hello_world as Function)());\n// stdout: 1056\n```\n\nç»“æœä¸æ˜¯\"hello, world!\"ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå‘ç”Ÿä»€ä¹ˆäº‹äº†ï¼Ÿ\n\nè¿™ä¸ªæ•°å­—å…¶å®æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„åœ°å€ï¼Œå®ƒæŒ‡å‘äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é€šè¿‡[string-layout](https://www.assemblyscript.org/memory.html#string-layout)è¿™ç¯‡æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ AssemblyScript çš„å­—ç¬¦ä¸²æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­æ’å¸ƒçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»£ç æŠŠå­—ç¬¦ä¸²å–å‡ºæ¥ã€‚\n\n```typescript\n// ...\nconst offset = (instance.exports.hello_world as Function)();\nconst memory = instance.exports.memory as WebAssembly.Memory;\nconst buffer = Buffer.from(memory.buffer);\nconst len = buffer.readUInt32LE(offset - 4);\n\nconsole.log(buffer.slice(offset, offset + len).toString());\n// stdout: hello, world!\n```\n\nWASM ä½¿ç”¨çš„æ˜¯[little endian byte order](https://webassembly.github.io/spec/core/syntax/instructions.html#memory-instructions)ï¼Œå› æ­¤æˆ‘ä»¬ç”¨`readUInt32LE`è€Œä¸æ˜¯`readUInt32BE`ã€‚\n\n## \\`hello, ${str}!\\`\n\næˆ‘ä»¬å·²ç»å­¦ä¼šæŠŠå­—ç¬¦ä¸²ä» WASM ä¼ åˆ° runtime ä¸­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ åå‘æ“ä½œã€‚\n\n```typescript\n// hello.ts\nexport function hello(str: string): string {\n  return `hello, ${str}!`;\n}\n```\n\nä½¿ç”¨ç¼–è¯‘å‚æ•°ï¼š\n\n```bash\nasc hello.ts --use abort= --target release\n```\n\næˆ‘ä»¬åªæ”¹äº†å‡ ä¸ªå­—ç¬¦ï¼Œä½†è¿™æ¬¡ç¼–è¯‘å‡ºçš„ hello.wat å·²ç»æœ‰ 400+è¡Œã€‚\n\nåœ¨å‰ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œå†…å­˜æ˜¯é™æ€çš„ï¼Œè€Œåœ¨è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬è¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°±æ¶‰åŠåˆ°äº†å†…å­˜çš„åŠ¨æ€ç®¡ç†ã€‚å› æ­¤ AssemblyScript éœ€è¦æŠŠå†…å­˜å›æ”¶è¿è¡Œæ—¶æ‰“åŒ…è¿› WASMï¼Œå°±å¢åŠ äº†æ–‡ä»¶ä½“ç§¯ã€‚\n\n```typescript\n// ...\nconst memory = instance.exports.memory as WebAssembly.Memory;\nconst buffer = Buffer.from(memory.buffer);\nconst str = \"wasm\";\nconst ptr = 1024;\nbuffer.writeUInt32LE(str.length, ptr - 4);\nBuffer.from(str).copy(buffer, ptr);\nconst offset = (instance.exports.hello as Function)(ptr);\nconst len = buffer.readUInt32LE(offset - 4);\n\nconsole.log(buffer.slice(offset, offset + len).toString());\n// stdout: hello, wasm!\n```\n\nè¿™é‡Œçš„`ptr = 1024`æ˜¯ä¸€ä¸ªå±é™©çš„åšæ³•ï¼Œè¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬å‡å®š WASM ä¸ä¼šä½¿ç”¨ç¬¬ 1024 ä¸ªå­—èŠ‚é™„è¿‘çš„å†…å­˜ï¼Œå®é™…ä½¿ç”¨ä¸­ä¸èƒ½è¿™ä¹ˆå†™ï¼Œè¿™æ ·å¯èƒ½ä¼šè¦†ç›–æ‰ WASM æ‰€éœ€è¦çš„æ•°æ®ï¼Œä½¿ WASM è¿è¡Œå¼‚å¸¸ã€‚\n\nAssemblyScript æä¾›äº†[Loader](https://www.assemblyscript.org/loader.html#loader)ï¼Œå°è£…äº†è¿™ç§é«˜çº§æ•°æ®ç»“æ„ä¼ é€’çš„æ–¹æ³•ï¼›Rust ä¹Ÿæä¾›äº†[wasm-bingen](https://github.com/rustwasm/wasm-bindgen)ï¼Œå¯ä»¥ç”Ÿæˆ`.js`å’Œ`.d.ts`æ–‡ä»¶ï¼Œåœ¨ js ä»£ç ä¸­ç›´æ¥ import å°±å¯ä»¥è°ƒç”¨ Rust ç¼–å†™çš„ WASM æ¨¡å—ä¸­çš„å‡½æ•°ã€‚\n\nåˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹å¦‚ä½•åœ¨ WASM ä¸ runtime ä¹‹é—´ä¼ é€’æ•°æ®å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚\n","pathname":"wasm/è¾“å…¥ä¸è¾“å‡º"},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["wasm","è¾“å…¥ä¸è¾“å‡º"]},"buildId":"XvQqgVKXZyTL6GdtsbpHY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>